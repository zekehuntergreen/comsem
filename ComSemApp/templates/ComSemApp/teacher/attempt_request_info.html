{% load static %}
<div class="row h-100">
    <div class="col-12 h-100">
        <div class="card-box">
            <div class="card">
                <div class='card-body'>
                    <!--card for displaying results-->
                    <b>Student</b><br>
                    {{attempt.student}} <br>
                    <b>Course</b><br>
                    {{ course.session }}<br>
                    <b>Correct Expression</b><br> 
                    {{attempt.expression.reformulation_text}} <br>
                    <b>Problem Expression</b><br> 
                    {{attempt.expression.expression}} <br>
                    <b>Graded Expression</b> (hover for details about each error)<br> 
                    <mark><span title="There could be errors shown here">{{attempt.transcription}}</span></mark><br>
                    <b>Audio Recording</b><br>
                    <audio controls title="Reformulation" style="width: 200px" class="previous_attempt_audio" src="{{ attempt.audio.url }}"></audio><br>
                    <b>Fluency Score</b><br>
                    {{attempt.wpm}}<br>
                    <b>Correctness Score</b><br>
                    {% if review.original_score%}
                        {{ review.original_score}}
                    {% else %}
                        {{attempt.correct}}
                    {% endif %}
                    <br>
                    <b>New Correctness Score <input type="number" min="0" max="100" style="width:85px;" id="myPercent" {% if review.original_score %}value="{{ attempt.correct }}"{% endif %}></b>
                    <div id="myTextboxContainer"></div>
                    <div style="position: relative;">
                        <b>Comments</b><br>
                        <textarea id="teacher_comments_box" style="width:100%;" rows="4">{{ review.comments }}</textarea>
                    </div>
                    <br>
                    {% if review %}
                        <button id="save">Save Changes</button>
                    {% else %}
                        <button id="submit">Submit</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div> 
<script>
    $("#submit").click(() => {
        console.log("submit clicked");
            submitForm("{% url 'teacher:request_review' course_id=course.id attempt_id=request.attempt.id %}")
        }
      });

    function submitForm(url){
        /*
          takes current data and send it in a post request to the server (SpeakingPracticeAttemptCreateView)
        */
        console.log("save in form called");
        console.log($("$teacher_comment_box").val())
        let reviewFormData = new FormData(); // creates new form
        reviewFormData.append('comments', $("$teacher_comment_box").val()); 
        reviewFormData.append('student', student);
        reviewFormData.append('audio', audioBlob);
        var csrf_token = '{{ csrf_token }}'; // grabs csrf_token for certification
      
        // returns a promise that calls the ajax, if successful resolves, if error OR takes more than 5 seconds
        // to return then rejects
        /*$.ajax({ // send POST request
            type: "POST",
            url: url, // links to html form above which specifies the url to recieve request
            data: attemptFormData,
            processData: false,
            contentType: false,
            timeout: 5000, // if takes longer than 5 secs, return timeout error
            headers: { // places token in request so that it is certified by server
              'X-CSRFToken': csrf_token
            },
            success:(response) => {
              cs_notification('success', "Attempt Saved")
              // inputs the id recieved into the html form
              $("#form").append("<input type='hidden' value="+response['id']+" name='attempt_ids'></input>");
              resolve();
            },
            error: (jqXHR, textStatus, errorThrown) => {
              cs_ajax_error(jqXHR, textStatus, errorThrown);
              reject();
            }
          });*/
      }
</script>
</body>
<script src="{% static "ComSemApp/js/ComSemRecording-opus.js" %}?{% now "U" %}"></script>